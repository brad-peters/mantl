---
- name: install vault
  sudo: yes
  yum:
    name: "{{ vault_package }}"
    state: present
  tags:
    - vault
    - bootstrap

- name: configure vault
  sudo: yes
  template:
    src: vault.hcl.j2
    dest: /etc/vault/vault.hcl
  tags:
    - vault

- name: enable vault
  sudo: yes
  service:
    name: vault
    enabled: yes
    state: started
  tags:
    - vault

- name: wait for vault port
  wait_for:
    port: 8200
  tags:
    - vault

- include: bootstrap.yml

- name: set token ttl
  shell: VAULT_TOKEN={{vault_root_token}} vault mount-tune -default-lease-ttl={{ vault_token_default_ttl }}s -max-lease-ttl={{ vault_token_max_ttl }}s auth/token
  no_log: true
  tags:
    - vault
